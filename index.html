<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>덕소고 방사선&전자파 위험 지도</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: pretendardbold, pretendard;
      text-align: center;
      overflow: hidden;
      user-select: none;
      touch-action: none;
    }

    h1 {
      margin: 20px 0;
    }

    #svg-frame {
      width: 80%;
      height: 70vh;
      border: none;
      display: block;
      margin: 0 auto;
      pointer-events: auto;
      background: #f9f9f9;
      touch-action: none;
    }

    button {
      margin: 5px 10px;
      padding: 10px 20px;
      font-size: 16px;
    }

    #description {
      margin-top: 10px;
      font-size: 18px;
    }
  </style>
</head>
<body>

<h1>덕소고 방사선&전자파 위험 지도</h1>

<div>
  <button onclick="selectBuilding('gm')">근면관</button>
  <button onclick="selectBuilding('sm')">소망관</button>
  <button onclick="selectBuilding('me')">믿음관</button>
</div>

<div id="floor-buttons" style="display:none;">
  <button onclick="changeFloor(1)">1층</button>
  <button onclick="changeFloor(2)">2층</button>
  <button onclick="changeFloor(3)">3층</button>
  <button onclick="changeFloor(4)">4층</button>
</div>

<iframe id="svg-frame" src="display: #f9f9f9"></iframe>

<div id="description"></div>

<script>
  let currentBuilding = 'gm';
  let scale = 1;
  let translateX = 0;
  let translateY = 0;
  let isDragging = false;
  let startX = 0;
  let startY = 0;
  let lastX = 0;
  let lastY = 0;
  let initialPinchDistance = null;
  let initialScale = 1;

  function selectBuilding(code) {
    currentBuilding = code;
    const floorButtons = document.getElementById('floor-buttons');
    floorButtons.style.display = 'block';

    const floorBtnList = floorButtons.querySelectorAll('button');
    floorBtnList.forEach(btn => btn.style.display = 'none');

    if (code === 'gm' || code === 'sm') {
      for (let i = 0; i < 4; i++) {
        floorBtnList[i].style.display = 'inline-block';
      }
    } else if (code === 'me') {
      for (let i = 0; i < 2; i++) {
        floorBtnList[i].style.display = 'inline-block';
      }
    }

    changeFloor(1);
  }

  function changeFloor(floor) {
    let src = '';
    if (currentBuilding === 'me') {
      if (floor === 1) {
        src = 'me_floor1.svg';
      } else if (floor === 2) {
        alert('믿음관 2층은 아직 준비되지 않았습니다.');
        return;
      } else {
        return; // 믿음관은 3, 4층 없음
      }
    } else {
      src = `${currentBuilding}_floor${floor}.svg`;
    }

    document.getElementById('svg-frame').src = src;
    document.getElementById('description').innerText = '';
    scale = 1;
    translateX = 0;
    translateY = 0;
  }

  function getPinchDistance(touches) {
    const dx = touches[0].clientX - touches[1].clientX;
    const dy = touches[0].clientY - touches[1].clientY;
    return Math.sqrt(dx * dx + dy * dy);
  }

  const iframe = document.getElementById('svg-frame');

  iframe.addEventListener('load', () => {
    const svgDoc = iframe.contentDocument || iframe.contentWindow.document;
    if (!svgDoc) return;

    const svg = svgDoc.querySelector('svg');
    if (!svg) return;

    svg.style.transformOrigin = "0 0";
    svg.style.transition = "transform 0.05s";

    const updateTransform = () => {
      svg.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
    };

    updateTransform();

    const targets = [
      { id: 'tclass', text: '여기는 교무실입니다.' },
      { id: 'class308', text: '여기는 3학년 8반 교실입니다.' },
      { id: 'class311', text: '여기는 3학년 11반 교실입니다.' },
      { id: 'class303', text: '여기는 3학년 3반 교실입니다.' },
      { id: 'maejum1', text: '여기는 매점입니다.' },
      { id: 'maejum2', text: '여기는 전자레인지 앞입니다.' },
      { id: 'restaurant', text: '여기는 학생식당입니다.' },
      { id: 'kitchen', text: '여기는 조리실입니다.' },
      { id: 'baul', text: '여기는 바울홀입니다.' },
      { id: 'biological_class', text: '여기는 생물화학실입니다.' }
    ];

    targets.forEach(({ id, text }) => {
      const el = svgDoc.getElementById(id);
      if (el) {
        el.style.cursor = 'pointer';
        el.addEventListener('click', () => {
          document.getElementById('description').innerText = text;
        });
      }
    });

    svg.addEventListener('wheel', (e) => {
      e.preventDefault();
      const rect = svg.getBoundingClientRect();
      const offsetX = e.clientX - rect.left;
      const offsetY = e.clientY - rect.top;

      const newScale = e.deltaY < 0 ? scale * 1.1 : scale / 1.1;
      const ratio = newScale / scale;

      translateX = offsetX - ratio * (offsetX - translateX);
      translateY = offsetY - ratio * (offsetY - translateY);

      scale = Math.max(0.5, Math.min(4, newScale));
      updateTransform();
    }, { passive: false });

    svg.addEventListener('mousedown', (e) => {
      isDragging = true;
      startX = e.clientX;
      startY = e.clientY;
      lastX = translateX;
      lastY = translateY;
      svg.style.cursor = 'grabbing';
    });

    svg.addEventListener('mousemove', (e) => {
      if (!isDragging) return;
      translateX = lastX + (e.clientX - startX);
      translateY = lastY + (e.clientY - startY);
      updateTransform();
    });

    svg.addEventListener('mouseup', () => {
      isDragging = false;
      svg.style.cursor = 'grab';
    });

    svg.addEventListener('mouseleave', () => {
      isDragging = false;
      svg.style.cursor = 'grab';
    });

    svg.addEventListener('touchstart', (e) => {
      if (e.touches.length === 2) {
        initialPinchDistance = getPinchDistance(e.touches);
        initialScale = scale;
      } else if (e.touches.length === 1) {
        isDragging = true;
        startX = e.touches[0].clientX;
        startY = e.touches[0].clientY;
        lastX = translateX;
        lastY = translateY;
      }
    }, { passive: false });

    svg.addEventListener('touchmove', (e) => {
      e.preventDefault();
      if (e.touches.length === 2 && initialPinchDistance) {
        const newDistance = getPinchDistance(e.touches);
        const ratio = newDistance / initialPinchDistance;
        scale = Math.max(0.5, Math.min(4, initialScale * ratio));
        updateTransform();
      } else if (e.touches.length === 1 && isDragging) {
        translateX = lastX + (e.touches[0].clientX - startX);
        translateY = lastY + (e.touches[0].clientY - startY);
        updateTransform();
      }
    }, { passive: false });

    svg.addEventListener('touchend', () => {
      isDragging = false;
      initialPinchDistance = null;
    });

  });
</script>

</body>
</html>
